---
import BaseLayout from "../../layouts/base-layout.astro";
import InstallCommand from "../../components/install-command.astro";
import RegistryHeader from "../../../registry/ui/astro/components/header/header.astro";
import HomePage from "../../components/demo/home-page";

const { name } = Astro.params;

// Load registry item JSON from public/r
let item = null;
try {
  const url = new URL(`/r/${name}.json`, import.meta.url);
  item = await fetch(url).then((r) => {
    if (!r.ok) return null;
    return r.json();
  });
} catch (err) {
  item = null;
}

if (!item) {
  // Let Astro handle 404 via throwing
  throw new Error(`Registry item not found: ${name}`);
}
---

<BaseLayout title={`${item.title ?? item.name} | Component`} description={item.description ?? ''}>
  <main class="max-w-6xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-2">{item.title ?? item.name}</h1>
    <p class="text-muted-foreground mb-6">{item.description}</p>

    <InstallCommand name={item.name} className="mb-6" />

    <!-- If this is the header (Astro) component, render a demo similar to /demo/header -->
    {item.name === 'header' && item.meta?.framework === 'astro' ? (
      <section class="space-y-6">
        <div class="rounded-xl border bg-card overflow-hidden">
          <div class="border-b px-4 py-3">
            <h2 class="font-semibold">Dropdown mobile menu</h2>
          </div>
          <RegistryHeader
            id="demo-header-dropdown"
            navItems={[{ label: 'Inicio', href: '#inicio' }, { label: 'Productos', href: '#productos' }]}
            logoSrc="/img/logo.webp"
            logoAlt="Demo Logo"
            mobileLogoSrc="/img/logo.webp"
            mobileMenuVariant="dropdown"
            className="relative"
          />
          <div class="p-6 pt-10 text-sm text-muted-foreground">Use <code>mobileMenuVariant="dropdown"</code> for a simple stacked mobile menu.</div>
        </div>

        <div class="rounded-xl border bg-card overflow-hidden">
          <div class="border-b px-4 py-3">
            <h2 class="font-semibold">Drawer mobile menu + language toggle + shrink on scroll</h2>
          </div>
          <RegistryHeader
            id="demo-header-drawer"
            navItems={[{ label: 'Inicio', href: '#inicio' }, { label: 'Contacto', href: '#contacto' }]}
            logoSrc="/img/logo.webp"
            logoAlt="Demo Logo"
            mobileMenuVariant="drawer"
            className="relative"
            langToggle={{ label: 'EN', href: '/' }}
            shrinkOnScroll={true}
            expandedHeightClass="h-[96px]"
            compactHeightClass="h-[68px]"
          />
          <div class="p-6 pt-10 text-sm text-muted-foreground">Use <code>mobileMenuVariant="drawer"</code> for an off-canvas menu.</div>
        </div>
      </section>
    ) : null}

    <!-- If this is the description (React) component, render the React demo HomePage inside the Astro page -->
    {item.name === 'description' && item.meta?.framework === 'react' ? (
      <div>
        <!-- hydrate React demo on client load -->
        <HomePage client:load />
      </div>
    ) : null}

    <section class="space-y-4 mt-6">
      <h2 class="text-xl font-semibold">Details</h2>
      <div class="text-sm text-muted-foreground">
        <div><strong>Framework:</strong> {item.meta?.framework ?? 'unknown'}</div>
        {item.dependencies ? <div><strong>Dependencies:</strong> {item.dependencies.join(', ')}</div> : null}
        {item.registryDependencies ? <div><strong>Registry dependencies:</strong> {item.registryDependencies.join(', ')}</div> : null}
      </div>
    </section>

    <section class="mt-6">
      <h2 class="text-xl font-semibold">Files</h2>
      <ul class="list-disc ml-6 text-sm">
        {item.files?.map((f: any) => (
          <li>{f.path}</li>
        ))}
      </ul>
    </section>
  </main>
</BaseLayout>
